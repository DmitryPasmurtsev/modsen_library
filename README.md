# MODSEN LIBRARY WEB API 

---
Приложение реализует основной и дополнительный функционал технического задания. Для написания приложения выбрана микросервисная архитектура. Для сервиса с информацией о книгах и сервиса для учета свободных книг были созданы отдельные базы данных согласно паттерну Database-per-service.

Информация об авторе вынесена в отдельню таблицу, чтобы поддерживать таблицу книг в 3НФ. В качестве дополнительного функционала добавлены CRUD операции над авторами. 

При добавлении новой книги, происходит проверка её автора на существование. В случае, если такого автора ещё нет, он добавлятеся в таблицу.

---
## Запуск

Перед запуском приложения необходимо изменить логин, пароль и хост, на котором запущена база данных, в файлах application.yml у сервисов book-service и library-service.

Запуск сервисов начианается с discovery-service и api-gateway, которые отвечают за регистрацию и коммуникацию микросервисов соответсвенно.

Порты по умолчанию:

+ discovery-service: 8761
+ api-gateway: 8080
+ authentication-service: 9001
+ book-service: 9002
+ library-service: 9003

Их можно изменить в файлах application.yml соответствующих микросервисов.

---
## Аутентификация

Обращение к микросервисам и их коммуникация осуществляется через API Gateway, на котором была настроена аутентификация с использованием JWT. Api-gateway осуществляет валидацию токенов и фильтрует приходящие на него запросы, отклоняя их или перенапраляя к нужному микросервису.

Получение токена осуществляется через authentication-service. Полученный токен передается в Authorization хедере запросов к микросервисам.

---
## Тестирование

Swagger:
* auth-service http://localhost:9001/swagger-ui/index.html#/  

* book-service http://localhost:9002/swagger-ui/index.html#/ 

* library-service http://localhost:9003/swagger-ui/index.html#/ 

При тестировании через Swagger запросы отправляются непосредственно к портам микросервисов, поэтому отправлять токен нет необходимости. Если метод подразумевает дальнейшую коммуникацию микросервисов, которая будет осуществляться через API Gateway, то такие методы поечены значком замка и требуют введение JWT токена (по нажатию на замок)  

При тестировании через Postman запросы отправляются через API Gateway и в хедере передается JWT токен.